<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {# Refresh page every 30 seconds #}
    <meta http-equiv="refresh" content="30" />
    {# Set the new_dono value to an element to read it in js #}
    <meta id="newDono" data="{{data.new_dono}}" />
    {# same for the server_url #}
    <meta id="serverUrl" data="{{data.server_url}}" />

    <title>Donation display for H1A V1</title>

    <style></style>

    <script>
      window.onload = () => {
        var newDono = document.getElementById("newDono").getAttribute("data");
        var serverUrl = document
          .getElementById("serverUrl")
          .getAttribute("data");
        // send the celebrated signal to server.
        // little delay to avoid oopsies.
        if (newDono === "true") {
          setTimeout(() => {
            fetch(serverUrl + "celebrated");
          }, 5000);
          let vid = document.getElementById("celebrationAudio");
          vid.volume = 0.2;
        }
      };
    </script>
  </head>

  <body>
    {% if data.new_dono %}
    <div class="newDonation">
      <div>Yeni bagis!</div>
      <span> {{data.latest[0].donor}} </span>
      <span> {{data.latest[0].amount}} </span>
      <span> ₺ </span>
      <div class="total">Toplam Odul Havuzu: {{data.total}}</div>
      <audio class="celebrationAudio" autoplay>
        <source src="{{data.server_url}}assets/applause.mp3" />
      </audio>
    </div>

    {% else %}
    <div class="total">Toplam Odul Havuzu: {{data.total}}</div>
    <hr />
    <div class="topDonors">
      <div>En Cok Bagis Yapanlar:</div>
      {% for donation in data.top[0:3] %}
      <div>
        <span> {{ donation.donor }} </span>
        <span> {{ donation.amount }} </span>
        <span> ₺ </span>
      </div>
      {% endfor %}
    </div>
    <hr />
    <div class="latestDonation">
      <div>En Son Bagislar:</div>
      {% for donation in data.latest[0:3] %}
      <div>
        <span>{{ donation.donor }} </span>
        <span> {{ donation.amount }}</span>
        <span>₺</span>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </body>
</html>
